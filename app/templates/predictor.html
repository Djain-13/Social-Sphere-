{% extends "layout.html" %}

{% block title %}Prediction Tool{% endblock %}

{% block styles %}
    <style>
        .container { max-width: 600px; margin: 40px auto; }
        h1, h2 { text-align: center; }
        form { display: flex; flex-direction: column; gap: 15px; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        label { font-weight: bold; }
        input, select { padding: 10px; border-radius: 4px; border: 1px solid #ccc; font-size: 1em; }
        button { padding: 10px 15px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        #result { 
            margin-top: 20px;
            padding: 20px;
            background-color: #1a253c;
            color: white;
            border-radius: 8px;
            font-size: 1.1em;
            text-align: left;
            line-height: 1.8;
        }
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #4a5568;
        }
        .result-item:last-child {
            border-bottom: none;
        }
        .result-item .label {
            font-weight: 500;
            color: #a0aec0;
        }
        .result-item .value {
            font-weight: bold;
            font-size: 1.2em;
            color: #ffffff;
        }
    </style>
{% endblock %}

{% block content %}
    <h1>ðŸ¤– Ad Performance Predictor</h1>
    
    <form id="prediction-form">
        <label for="total_budget">Total Budget ($)</label>
        <input type="number" id="total_budget" name="total_budget" value="50000" required>

        <label for="duration_days">Duration (Days)</label>
        <input type="number" id="duration_days" name="duration_days" value="60" required>
        
        <label for="ad_platform">Ad Platform</label>
        <select id="ad_platform" name="ad_platform" required>
            <option value="Facebook">Facebook</option>
            <option value="Instagram">Instagram</option>
        </select>
        
        <label for="ad_type">Ad Type</label>
        <select id="ad_type" name="ad_type" required>
            <option value="Video">Video</option>
            <option value="Image">Image</option>
            <option value="Carousel">Carousel</option>
            <option value="Stories">Stories</option>
        </select>
        
        <label for="target_gender">Target Gender</label>
        <select id="target_gender" name="target_gender" required>
            <option value="All">All</option>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
        </select>
        
        <button type="submit">Predict Performance</button>
    </form>
    
    <h2>Prediction Results</h2>
    <div id="result">
        Your predictions will appear here.
    </div>
{% endblock %}

{% block scripts %}
    <script>
        document.getElementById('prediction-form').addEventListener('submit', async function(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData.entries());
            const resultDiv = document.getElementById('result');
            resultDiv.textContent = 'Calculating...';

            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const result = await response.json();

                // Check if there was an error from the backend
                if (result.error) {
                    throw new Error(result.error);
                }
                
                // Display the multiple results in a formatted way
                resultDiv.innerHTML = `
                    <div class="result-item">
                        <span class="label">Predicted Purchases:</span>
                        <span class="value">${result.predicted_purchase.toFixed(2)}</span>
                    </div>
                    <div class="result-item">
                        <span class="label">Predicted Clicks:</span>
                        <span class="value">${result.predicted_click.toFixed(2)}</span>
                    </div>
                    <div class="result-item">
                        <span class="label">Predicted Shares:</span>
                        <span class="value">${result.predicted_share.toFixed(2)}</span>
                    </div>
                `;

            } catch (error) {
                console.error('Error:', error);
                resultDiv.textContent = 'Error making prediction.';
            }
        });
    </script>
{% endblock %}